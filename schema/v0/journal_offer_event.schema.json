{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://sollabshq.com/schemas/v0/journal_offer_event.schema.json",
  "title": "JournalOfferEvent",
  "type": "object",
  "additionalProperties": false,
  "required": ["eventId", "eventType", "ts", "threadId", "momentId", "evidenceSpan"],
  "properties": {
    "eventId": { "type": "string", "minLength": 1 },

    "eventType": {
      "type": "string",
      "enum": [
        "journal_offer_shown",
        "journal_offer_accepted",
        "journal_offer_declined",
        "journal_offer_muted_or_tuned",
        "journal_draft_generated",
        "journal_entry_saved",
        "journal_entry_edited_before_save"
      ]
    },

    "ts": { "type": "string", "format": "date-time" },

    "threadId": { "type": "string", "minLength": 1 },
    "momentId": { "type": "string", "minLength": 1 },

    "evidenceSpan": {
      "type": "object",
      "additionalProperties": false,
      "required": ["startMessageId", "endMessageId"],
      "properties": {
        "startMessageId": { "type": "string", "minLength": 1 },
        "endMessageId": { "type": "string", "minLength": 1 }
      }
    },

    "phaseAtOffer": {
      "type": "string",
      "enum": ["rising", "peak", "downshift", "settled"]
    },

    "modeSelected": {
      "type": "string",
      "enum": ["verbatim", "assist"]
    },

    "userAction": {
      "type": "string",
      "enum": ["save", "edit", "not_now", "disable_or_tune"]
    },

    "cooldownActive": { "type": "boolean" },

    "latencyMs": { "type": "integer", "minimum": 0 },

    "refs": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cpbId": { "type": "string", "minLength": 1 },
        "draftId": { "type": "string", "minLength": 1 },
        "entryId": { "type": "string", "minLength": 1 },
        "requestId": { "type": "string", "minLength": 1 }
      }
    },

    "tuning": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "newCooldownMinutes": { "type": "integer", "minimum": 0, "maximum": 1440 },
        "avoidPeakOverwhelm": { "type": "boolean" },
        "offersEnabled": { "type": "boolean" }
      }
    }
  }
}
